<!DOCTYPE composition PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN"
    "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<ui:composition xmlns="http://www.w3.org/1999/xhtml"
	xmlns:s="http://jboss.com/products/seam/taglib"
	xmlns:ui="http://java.sun.com/jsf/facelets"
	xmlns:f="http://java.sun.com/jsf/core"
	xmlns:h="http://java.sun.com/jsf/html"
	xmlns:rich="http://richfaces.org/rich"
	xmlns:a4j="http://richfaces.org/a4j" template="/layout/template.xhtml">

	<style>
.roundButton {
	-moz-border-radius: 10px;
	border-radius: 10px;
	width: 50px;
}
</style>


	<ui:define name="body">
		<a4j:form>
			<h:panelGrid columns="2">
				<h:panelGrid>
				
					<rich:progressBar id="previewProgress"
						value="#{preview.percentsDone}" styleClass="roundButton"
						interval="1000" minValue="0" maxValue="100"
						enabled="#{!preview.done}">
						<h:outputText value="#{preview.stringStatus}" />
					</rich:progressBar>
					<h:panelGrid id="statusPanel" columns="4">

						<a4j:commandButton value="Modify query"
							action="#{preview.refine()}" styleClass="roundButton" />

						<a4j:commandButton value="Stop waiting" action="#{preview.cancel}"
							styleClass="roundButton" disabled="#{preview.done}" />
						<a4j:commandButton value="Save query"
							action="#{query.saveQuery()}" styleClass="roundButton"
							disabled="#{!preview.done}" />
					</h:panelGrid>

					<h:outputText value="#{queryData.queryString}" />

					<rich:panel id="commentsPanel">
						<f:facet name="header">
							<h:outputText value="Comments"></h:outputText>
						</f:facet>

						<h:inputTextarea cols="55" rows="3" value="#{queryData.comments}"
							disabled="#{!(preview.done)}">
							<a4j:support event="onchange" reRender="commentsPanel" />
						</h:inputTextarea>
					</rich:panel>


				</h:panelGrid>

				<ui:include src="/xhtml/consumer/consumerPanel.xhtml" />

			</h:panelGrid>

			<ui:include src="/xhtml/preview/table.xhtml" />

		</a4j:form>

		<a4j:region>
			<h:form>
				<a4j:poll id="previewTablePoll" interval="1000"
					enabled="#{!preview.done}"
					reRender="previewTable,statusPanel,commentsPanel" />
			</h:form>
		</a4j:region>

	</ui:define>

</ui:composition>
